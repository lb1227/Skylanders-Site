<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Collectibles</title>
  <style>
    .form-box {
      margin-left: 50px;
      width: 350px;
    }

    .show-password {
      display: flex;
      align-items: center;
      gap: 5px;
      margin-bottom: 10px;
    }

    .back-btn {
      margin-top: 10px;
      width: 100%;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      padding: 20px;
      background-color: #f4f4f4;
    }
    .container {
      display: none;
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      background: #ddd;
      margin: 5px 0;
      padding: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-radius: 5px;
      animation: fadeIn 0.4s ease-in;
    }
    button {
      background: red;
      color: white;
      border: none;
      padding: 5px;
      cursor: pointer;
      border-radius: 3px;
    }
    img {
      width: 250px;
      height: auto;
      object-fit: cover;
      border-radius: 5px;
      margin-right: 10px;
      transition: transform 0.3s ease-in-out;
    }
    img:hover {
      transform: scale(1.05);
    }
    .collectible-item {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="authControls" style="display: flex; justify-content: flex-end; gap: 10px;">
      <button id="loginBtn" onclick="window.location.href='login.html'">Login</button>
      <button id="signupBtn" onclick="window.location.href='signup.html'">Sign Up</button>
      <button id="logoutBtn" onclick="logout()" style="display: none;">Logout</button>
    </div>
    <h2>My Collectibles</h2>
    <label for="gameSelector">Select Game:</label>
    <select id="gameSelector" onchange="switchGame()">
      <option value="Spyro's Adventure">Spyro's Adventure</option>
      <option value="Giants">Giants</option>
    </select>
    <div id="collectibleContainer">
      <img id="collectibleImage" alt="Collectible Image" />
      <p id="collectibleName"></p>
      <select id="statusInput">
        <option value="Have it">Have it</option>
        <option value="Don't have it">Don't have it</option>
      </select>
      <button id="nextButton">Next</button>
      <button id="undoButton">Undo</button>
    </div>
    <h3>Collected Items</h3>
    <ul id="collectiblesList"></ul>
  </div>

  <script>
    const games = {
      "Spyro's Adventure": [
        { name: "Bash", image: "https://skylanderscharacterlist.com/wp-content/uploads/2014/03/Bash.png" },
        { name: "Boomer", image: "https://skylanderscharacterlist.com/wp-content/uploads/2013/02/Boomer1.png" },
        { name: "Camo", image: "https://skylanderscharacterlist.com/wp-content/uploads/2014/02/Camo.png" }
      ],
      "Giants": []
    };

    let currentGame = "Spyro's Adventure";
    let collectibles = games[currentGame];
    let collectiblesQueue = [...collectibles];
    let collectedItems = [];
    let lastItem = null;

    function showCurrentCollectible() {
      if (collectiblesQueue.length > 0) {
        document.getElementById("collectibleImage").src = collectiblesQueue[0].image;
        document.getElementById("collectibleName").innerText = collectiblesQueue[0].name;
      }
    }

    function logout() {
      localStorage.removeItem("sky_user");
      location.reload();
    }

    window.onload = () => {
      const user = localStorage.getItem("sky_user");
      if (!user && window.location.protocol !== "file:") {
        alert("You must be logged in to access your collectibles.");
        window.location.href = 'login.html';
        return;
      }
      document.querySelector('.container').style.display = 'block';
      const welcome = document.createElement('p');
      welcome.textContent = `Welcome, ${user}!`;
      document.querySelector('.container').prepend(welcome);

      const loginBtn = document.getElementById("loginBtn");
      const signupBtn = document.getElementById("signupBtn");
      const logoutBtn = document.getElementById("logoutBtn");
      if (loginBtn) loginBtn.style.display = "none";
      if (signupBtn) signupBtn.style.display = "none";
      if (logoutBtn) logoutBtn.style.display = "inline-block";

      loadProgress(user);
      showCurrentCollectible();
    };

    function loadProgress(user) {
      const saved = localStorage.getItem(`sky_progress_${user}`);
      if (saved) {
        const parsed = JSON.parse(saved);
        collectedItems = parsed.collected || [];
        collectiblesQueue = parsed.queue || [...collectibles];
        renderCollectedList();
      }
    }

    function switchGame() {
      currentGame = document.getElementById("gameSelector").value;
      collectibles = games[currentGame];
      collectiblesQueue = [...collectibles];
      collectedItems = [];
      lastItem = null;
      document.getElementById("collectiblesList").innerHTML = "";
      showCurrentCollectible();
    }

    function saveProgress() {
      const user = localStorage.getItem("sky_user");
      if (!user) return;
      const data = {
        collected: collectedItems,
        queue: collectiblesQueue
      };
      localStorage.setItem(`sky_progress_${user}`, JSON.stringify(data));
    }

    document.getElementById("nextButton").onclick = () => {
      const status = document.getElementById("statusInput").value;
      const current = collectiblesQueue[0];
      if (!current) return;

      if (status === "Don't have it") {
        collectiblesQueue.shift();
        showCurrentCollectible();
        saveProgress();
        return;
      }

      collectiblesQueue.shift();

      const list = document.getElementById("collectiblesList");
      const li = document.createElement("li");
      li.innerHTML = `
        <div class="collectible-item">
          <img src="${current.image}" alt="${current.name}" />
          <span>${current.name} - <strong>${status}</strong></span>
        </div>
        <button onclick="removeCollectible('${current.name}', this)">Remove</button>
      `;
      list.appendChild(li);
      collectedItems.push(current);
      lastItem = current;

      showCurrentCollectible();
      saveProgress();
    };

    function removeCollectible(name, button) {
  const li = button.closest('li');
  if (li) li.remove();

  const index = collectedItems.findIndex(c => c.name === name);
  if (index !== -1) {
    const [restored] = collectedItems.splice(index, 1);
    collectiblesQueue.unshift(restored);
    showCurrentCollectible();
    saveProgress();
  }
}

function renderCollectedList() {
      const list = document.getElementById("collectiblesList");
      list.innerHTML = "";
      collectedItems.forEach(item => {
        const li = document.createElement("li");
        li.innerHTML = `
          <div class="collectible-item">
            <img src="${item.image}" alt="${item.name}" />
            <span>${item.name} - <strong>Have it</strong></span>
          </div>
          <button onclick="removeCollectible('${item.name}', this)">Remove</button>
        `;
        list.appendChild(li);
      });
    }
  </script>
</body>
</html>
